
## Installation

```bash
$ npm install
```

## Running the app (without docker)

### Migrations
Make sure you have a PostgreSQL server available and set the `DATABASE_URL` environment variable to point to that Postgres instance, like:

```bash
$ cd server/src/
# run migrations (using [knex-migrate](https://github.com/sheerun/knex-migrate))
$ export DATABASE_URL=postgres://admin:5UPP3rSecr3tPAssword@localhost:54320/thenurse && knex-migrate up
```

Also, there's an API endpoint that runs the migrations once the app is started:
`GET http://localhost:8000/api/migrate`

```bash
# development
$ npm run start

# watch mode
$ npm run start:dev

# production mode
$ npm run start:prod
```

### GraphQL

The graphql schema is generated by merging on all the `*.graphql` files found throughout the modules. 
It is generated automatically when the app starts, or when running:

```bash
server $ node generate-typings.js
```


## Development workflow
If not specified otherwise, all the steps below are issued from the `server/` folder


### 1. Create a new migration
Migrations are used for handling database schema (create/update/delete tables, columns. Even adding some seed data one-time can be done with migrations).
Make sure you have the `DATABASE_URL` env variable configured to point to the postgres instance from docker

```bash
$knex --knexfile ./src/knexfile.js migrate:make add_heartbeats
```
### 2. Create a new nestjs resource:

```bash
$nest generate resource heartbeats
```

The output for GraphQL:
```
? What transport layer do you use? GraphQL (schema first)
? Would you like to generate CRUD entry points? Yes
CREATE src/heartbeats/heartbeats.graphql (482 bytes)
CREATE src/heartbeats/heartbeats.module.ts (259 bytes)
CREATE src/heartbeats/heartbeats.resolver.spec.ts (575 bytes)
CREATE src/heartbeats/heartbeats.resolver.ts (1104 bytes)
CREATE src/heartbeats/heartbeats.service.spec.ts (488 bytes)
CREATE src/heartbeats/heartbeats.service.ts (695 bytes)
CREATE src/heartbeats/dto/create-heartbeat.input.ts (37 bytes)
CREATE src/heartbeats/dto/update-heartbeat.input.ts (212 bytes)
CREATE src/heartbeats/entities/heartbeat.entity.ts (26 bytes)
UPDATE package.json (2790 bytes)
UPDATE src/app.module.ts (1839 bytes)
```

The output for REST:
```
? What transport layer do you use? REST API
? Would you like to generate CRUD entry points? Yes
CREATE src/heartbeats/heartbeats.controller.spec.ts (616 bytes)
CREATE src/heartbeats/heartbeats.controller.ts (999 bytes)
CREATE src/heartbeats/heartbeats.module.ts (282 bytes)
CREATE src/heartbeats/heartbeats.service.spec.ts (488 bytes)
CREATE src/heartbeats/heartbeats.service.ts (679 bytes)
CREATE src/heartbeats/dto/create-heartbeat.dto.ts (35 bytes)
CREATE src/heartbeats/dto/update-heartbeat.dto.ts (189 bytes)
CREATE src/heartbeats/entities/heartbeat.entity.ts (26 bytes)
UPDATE package.json (2790 bytes)
UPDATE src/app.module.ts (1906 bytes)
```


## Test

```bash
# unit tests
$ npm run test

# e2e tests
$ npm run test:e2e

# test coverage
$ npm run test:cov
```

## Support

Nest is an MIT-licensed open source project. It can grow thanks to the sponsors and support by the amazing backers. If you'd like to join them, please [read more here](https://docs.nestjs.com/support).


